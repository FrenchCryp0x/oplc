<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Open Password Leak Check</title>
  <!-- Allow cross-origin fetch to the API Space -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; connect-src *; base-uri 'none'; form-action 'none'">
  <link rel="stylesheet" href="style.css">
  <style>
    /* Fallback minimal styles in case style.css is absent */
    :root{--bg:#0b1220;--fg:#e6eef8;--muted:#9fb3c8;--ok:#2ecc71;--bad:#ff6b6b}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif;background:var(--bg);color:var(--fg);display:grid;place-items:center;min-height:100vh;margin:0}
    main{width:min(720px,92vw);padding:32px;border-radius:20px;background:rgba(255,255,255,0.05);box-shadow:0 10px 30px rgba(0,0,0,.4)}
    h1{margin:0 0 12px;font-size:1.9rem}
    p{color:var(--muted)}
    .row{display:flex;gap:10px;align-items:center}
    input[type=password], input[type=text]{flex:1;padding:14px 16px;border-radius:12px;border:1px solid #2a3b55;background:#0f182b;color:var(--fg);font-size:1rem}
    button{margin-top:12px;padding:12px 16px;border-radius:12px;border:0;background:#2a72ff;color:#fff;font-weight:600;cursor:pointer}
    button[disabled]{opacity:.7;cursor:progress}
    label{user-select:none}
    .stat{margin-top:16px;padding:12px;border-radius:12px;background:#0f182b}
    .ok{color:var(--ok)}.bad{color:var(--bad)}
    .foot{margin-top:18px;font-size:.85rem;color:var(--muted)}
  </style>
</head>
<body>
<main>
  <h1>Open Password Leak Check</h1>
  <p>We never send your password to the server. It’s hashed locally (SHA‑1) and only the first <code>5</code> hex chars are sent.</p>
  <div class="row">
    <input id="pw" type="password" placeholder="Enter a password to check…" autocomplete="off" spellcheck="false" />
    <label><input id="show" type="checkbox"> Show</label>
  </div>
  <button id="btn">Check</button>
  <div id="out" class="stat" hidden></div>
  <p class="foot">Tip: use a password manager; never reuse passwords.</p>
</main>
<script>
// Prefer ?api=... ; otherwise use your live API Space.
const qsApi = new URLSearchParams(location.search).get('api');
const API_BASE = qsApi || 'https://r3ddkahili-oplc-api.hf.space';
async function sha1Hex(str){
  const enc = new TextEncoder().encode(str);
  const buf = await crypto.subtle.digest('SHA-1', enc);
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('').toUpperCase();
}
function render(msg, bad){
  const el = document.getElementById('out');
  el.hidden = false; el.className = 'stat ' + (bad ? 'bad':'ok');
  el.textContent = msg;
}
function setBusy(b){
  const btn = document.getElementById('btn');
  btn.disabled = b; btn.textContent = b ? 'Checking…' : 'Check';
}
async function check(ev){
  ev && ev.preventDefault();
  try{
    setBusy(true);
    const pw = document.getElementById('pw').value;
    if(!pw){ render('Please enter a password.', true); return; }
    const hash = await sha1Hex(pw);
    const prefix = hash.slice(0,5), suffix = hash.slice(5);
    const res = await fetch(`${API_BASE}/range/${prefix}`, { headers: { 'User-Agent': 'OPLC-UI/1.0' } });
    if(!res.ok){ render('Service unavailable. Check API URL.', true); return; }
    const text = await res.text();
    let count = 0;
    for(const ln of text.split('\n')){
      const [suf, cnt] = ln.split(':');
      if(suf === suffix){ count = parseInt(cnt||'0', 10); break; }
    }
    render(count>0 ? `⚠️ Pwned! Seen ${count.toLocaleString()} times.` : '✅ Not found in the dataset. Use a unique, strong password.', count>0);
  }catch(err){
    console.error(err);
    render('Unexpected error. Open the browser console for details.', true);
  }finally{
    setBusy(false);
  }
}
window.addEventListener('DOMContentLoaded', () => {
  const pw = document.getElementById('pw');
  document.getElementById('btn').addEventListener('click', check);
  pw.addEventListener('keydown', e => { if(e.key === 'Enter') check(e); });
  document.getElementById('show').addEventListener('change', e => { pw.type = e.target.checked ? 'text' : 'password'; });
});
</script>
</body>
</html>
